#!/bin/sh
#
#  Copyright (C) 2009 Advanced Micro Devices, Inc.  All Rights Reserved.
#
#  This program is free software; you can redistribute it and/or modify it
#  under the terms of version 2 of the GNU General Public License as
#  published by the Free Software Foundation.
#
#  This program is distributed in the hope that it would be useful, but
#  WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
#
#  Further, this software is distributed without any warranty that it is
#  free of the rightful claim of any third person regarding infringement 
#  or the like.  Any license provided herein, whether implied or 
#  otherwise, applies only to this software file.  Patent licenses, if 
#  any, provided herein do not apply to combinations of this program with 
#  other software, or any other product whatsoever.  
#
#  You should have received a copy of the GNU General Public License along
#  with this program; if not, write the Free Software Foundation, Inc., 59
#  Temple Place - Suite 330, Boston MA 02111-1307, USA.
#

# Verify sources against glibc source base, which is useful
# in checking compliance with section 2a of LGPL 2.1:
#
#    b) You must cause the files modified to carry prominent notices
#    stating that you changed the files and the date of any change.
#
# If sources compared then no notices need to be added.
#
# Currently the sources are compared against:
#
# commit 686bfb32882302132056b57bb1b56de0e172e802
# Author: Ulrich Drepper <drepper@redhat.com>
# Date:   Tue Feb 10 17:21:29 2009 +0000
#
# of a clone of the glibc GIT tree: git://sources.redhat.com/git/glibc.git
# 
# Note that the file config.h is generated by the configuration process:
# cd <PATH_TO_TREE>
# mkdir b
# cd b
# <PATH_TO_TREE>/b/configure --prefix=$PWD/local && make && make install
#
# Note that configure phase is only needed to build config.h, though running
# subsequent make phases are useful for testing.
#
prog=`basename $0`
usage_and_die () {
    echo usage: $prog path_to_glibc_tree >&2
    exit 1
}

[ $# == 1 ] || usage_and_die
dir=$1
if [ ! -d "$dir" ] ; then
    echo $prog: $1 not a directory
    usage_and_dir
fi

err=0
while : ; do
    read a
    test -z "$a" && break
    set "$a"
    diff -u $dir/$1 $2 || err=1
done < file_mappings

if [ $err = 0 ]; then
    echo sources compared
else
    echo sources did not compare
fi
exit $err
